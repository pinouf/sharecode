<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>
        <parameter key="form.parameters.dir">LaFourchette\Bundle\ParametersBundle\Form\</parameter>
        <parameter key="form.parameters.processor.dir">%form.parameters.dir%Processor\</parameter>
        <parameter key="form.parameters.listener.dir">%form.parameters.dir%Listener\</parameter>

        <parameter key="parameters.formatter.dir">LaFourchette\Bundle\ParametersBundle\Formatter\</parameter>
        <parameter key="form.take_a_reservation.processor.class">%form.parameters.processor.dir%TakeAReservationProcessor</parameter>
        <parameter key="form.sale_type_edit.processor.class">%form.parameters.processor.dir%SaleTypeEditProcessor</parameter>
        <parameter key="form.personalized_reservation_field.type.class">%form.parameters.dir%Type\TakeAReservation\PersonalizedReservationFieldType</parameter>

        <parameter key="personalized_reservation_field_list.formatter.class">%parameters.formatter.dir%PersonalizedReservationFieldListFormatter</parameter>

        <parameter key="salesTypeStock.update.dir">LaFourchette\Bundle\ParametersBundle\SalesTypeStock\</parameter>
        <parameter key="salesTypeStock.update.class">%salesTypeStock.update.dir%SalesTypeStockUpdate</parameter>

        <parameter key="form.package_type.class">%form.parameters.dir%Extension\Core\Type\PackageType</parameter>

        <parameter key="extension.credit_card_expired.checker.class">LaFourchette\Bundle\ParametersBundle\Extension\CreditCardExpirationCheckerExtension</parameter>
    </parameters>

    <services>
        <service id="form.sale_type_edit.processor" class="%form.sale_type_edit.processor.class%">
            <argument type="collection">
                <argument key="starter">%menu_type_composition.starter.id%</argument>
                <argument key="main_course">%menu_type_composition.main_course.id%</argument>
                <argument key="dessert">%menu_type_composition.dessert.id%</argument>
            </argument>
            <argument type="service" id="logger" />
            <tag name="monolog.logger" channel="form.processor" />
        </service>
        <service id="form.take_a_reservation.processor" class="%form.take_a_reservation.processor.class%">
            <argument type="service" id="module.restaurant" />
            <argument type="service" id="logger" />
            <tag name="monolog.logger" channel="form.processor" />
        </service>

        <service id="form.personalized_reservation_field.type" class="%form.personalized_reservation_field.type.class%">
            <tag name="form.type" alias="personalized_reservation_field" />
            <argument type="service" id="business.personalized_mail" />
            <argument type="service" id="business.personalized_sms" />
        </service>

        <service id="personalized_reservation_field_list.formatter" class="%personalized_reservation_field_list.formatter.class%">
            <argument type="service" id="translator" />
        </service>

        <service id="salesTypeStock.update" class="%salesTypeStock.update.class%">
            <argument type="service" id="module.restaurant" />
            <argument type="service" id="translator" />
            <argument type="service" id="logger" />
        </service>

        <service id="form.package_type.extension" class="%form.package_type.class%">
            <argument type="service" id="business.package" />
            <tag name="form.type" alias="package_choice" />
        </service>

        <!-- Payment -->
        <service id="form.iban_informations.extension" class="%form.parameters.dir%IBANInformationsType">
            <tag name="form.type" alias="iban_informations" />
        </service>

        <service id="twig.extension.credit_card_expired.checker" class="%extension.credit_card_expired.checker.class%">
            <argument type="service" id="session" />
            <argument type="service" id="security.context" />
            <argument type="service" id="business.restaurant" />
            <argument type="service" id="business.credit_card_transaction" />
            <tag name="twig.extension" />
        </service>
    </services>
</container>
